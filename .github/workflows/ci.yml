name: CI

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate repository hygiene
        run: |
          set -euo pipefail
          if git ls-files | grep -E '(^\.confluence\.env$|^\.auth/)'; then
            echo "Forbidden secret file tracked in git index." >&2
            exit 1
          fi

      - name: Validate Markdown files
        run: |
          python3 - <<'PY'
          from pathlib import Path
          root = Path(".")
          files = sorted(root.rglob("*.md"))
          if not files:
              raise SystemExit("No markdown files found.")
          empty = []
          for path in files:
              data = path.read_text(encoding="utf-8")
              if not data.strip():
                  empty.append(str(path))
          if empty:
              raise SystemExit("Empty markdown files: " + ", ".join(empty))
          print(f"Validated {len(files)} markdown files.")
          PY

      - name: Lint GitHub Actions workflows
        uses: rhysd/actionlint@v1.7.11
